
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>tasks: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">todo-console/cmd/tasks/tasks.go (94.7%)</option>
				
				<option value="file1">todo-console/cmd/tasks/utils.go (90.7%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package tasks

import (
        "errors"
        "fmt"
        "os"
        "strconv"
        "text/tabwriter"
        "time"
        file_utils "todo-console/cmd/utils/file"

        "github.com/mergestat/timediff"
)

var FILE_PATH = "./data/db.csv"

type Task struct {
        ID          int64
        description string
        createdAt   time.Time
        isComplete  bool
}

type Tasks = []Task

var COLUMNS_NAMES = []string{
        "ID", "Description", "CreatedAt", "IsComplete",
}

func Add(description string) error <span class="cov8" title="1">{
        var data file_utils.TCsvData

        csvList := getList()

        listLength := int64(len(csvList))

        if listLength == 0 </span><span class="cov8" title="1">{
                data = append(data, COLUMNS_NAMES)
        }</span> else<span class="cov8" title="1"> {
                data = append(data, csvList...)
        }</span>

        <span class="cov8" title="1">lastRowId := getLastRowId()
        taskRow := createTaskRow(lastRowId, description, false, time.Now())

        data = append(data, taskRow)

        err := file_utils.WriteToCSV(FILE_PATH, data)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov8" title="1">return nil</span>
}

func List(extended bool) <span class="cov8" title="1">{
        w := tabwriter.NewWriter(os.Stdout, 1, 2, 3, ' ', tabwriter.Debug)
        defer w.Flush()

        if extended </span><span class="cov8" title="1">{
                fmt.Fprintln(w, " ID \t Task \t Created  \t Done")
        }</span> else<span class="cov8" title="1"> {
                fmt.Fprintln(w, " ID \t Task \t Created ")
        }</span>

        <span class="cov8" title="1">for _, task := range getListTasks() </span><span class="cov8" title="1">{
                duration := time.Since(task.createdAt)
                timeDiff := timediff.TimeDiff(time.Now().Add(duration))
                idStr := strconv.FormatInt(task.ID, 10)
                isCompleteStr := strconv.FormatBool(task.isComplete)
                if extended </span><span class="cov8" title="1">{
                        fmt.Fprintf(w, " %v \t %v \t %v \t %v \n", idStr, task.description, timeDiff, isCompleteStr)
                }</span> else<span class="cov8" title="1"> {
                        fmt.Fprintf(w, " %v \t %v \t %v \n", idStr, task.description, timeDiff)
                }</span>
        }
}

func Complete(id int64) error <span class="cov8" title="1">{
        index, exist := findTaskById(id)

        if !exist </span><span class="cov8" title="1">{
                return errors.New("can't complete task as can't find index")
        }</span>

        <span class="cov8" title="1">list := getListTasks()
        row := list[index]
        row.isComplete = true
        list[index] = row

        var data file_utils.TCsvData
        data = append(data, COLUMNS_NAMES)

        for _, value := range list </span><span class="cov8" title="1">{
                taskRow := createTaskRow(value.ID, value.description, value.isComplete, value.createdAt)
                data = append(data, taskRow)
        }</span>

        <span class="cov8" title="1">err := file_utils.WriteToCSV(FILE_PATH, data)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov8" title="1">return nil</span>
}

func Delete(id int64) error <span class="cov8" title="1">{
        index, exist := findTaskById(id)

        if !exist </span><span class="cov8" title="1">{
                return errors.New("can't delete task as can't find index")
        }</span>

        <span class="cov8" title="1">list := getListTasks()

        var data file_utils.TCsvData
        data = append(data, COLUMNS_NAMES)

        for listIndex, value := range list </span><span class="cov8" title="1">{
                if int64(listIndex) == index </span><span class="cov8" title="1">{
                        continue</span>
                }
                <span class="cov8" title="1">taskRow := createTaskRow(value.ID, value.description, value.isComplete, value.createdAt)
                data = append(data, taskRow)</span>
        }

        <span class="cov8" title="1">err := file_utils.WriteToCSV(FILE_PATH, data)
        if err != nil </span><span class="cov0" title="0">{
                return err
        }</span>

        <span class="cov8" title="1">return nil</span>
}
</pre>
		
		<pre class="file" id="file1" style="display: none">package tasks

import (
        "strconv"
        "time"
        file_utils "todo-console/cmd/utils/file"
)

func getList() file_utils.TCsvData <span class="cov8" title="1">{
        csvList, err := file_utils.ReadFromCSV(FILE_PATH)
        if err != nil </span><span class="cov0" title="0">{
                csvList = [][]string{}
        }</span>
        <span class="cov8" title="1">return csvList</span>
}

func convertCsvRowToTaskStruct(columnIndex int64, value string, task *Task) error <span class="cov8" title="1">{
        var _err error = nil
        switch columnIndex </span>{
        case 0:<span class="cov8" title="1">
                </span><span class="cov8" title="1">{
                        id, err := strconv.ParseInt(value, 10, 64)
                        if err != nil </span><span class="cov0" title="0">{
                                _err = err
                        }</span>
                        <span class="cov8" title="1">task.ID = id</span>
                }
        case 1:<span class="cov8" title="1">
                </span><span class="cov8" title="1">{
                        task.description = value
                }</span>
        case 2:<span class="cov8" title="1">
                </span><span class="cov8" title="1">{
                        createdAt, err := time.Parse(time.RFC3339, value)
                        if err != nil </span><span class="cov0" title="0">{
                                _err = err
                        }</span>
                        <span class="cov8" title="1">task.createdAt = createdAt</span>
                }
        case 3:<span class="cov8" title="1">
                isComplete, err := strconv.ParseBool(value)
                if err != nil </span><span class="cov0" title="0">{
                        _err = err
                }</span>
                <span class="cov8" title="1">task.isComplete = isComplete</span>
        }
        <span class="cov8" title="1">return _err</span>
}

func getListTasks() Tasks <span class="cov8" title="1">{
        csvList := getList()
        listLength := int64(len(csvList))

        if listLength == 0 </span><span class="cov8" title="1">{
                return []Task{}
        }</span>

        <span class="cov8" title="1">var tasks []Task

        for rowIndex, row := range csvList </span><span class="cov8" title="1">{
                if rowIndex == 0 </span><span class="cov8" title="1">{
                        continue</span>
                }
                <span class="cov8" title="1">var task Task

                // TODO: Add separate function for this logic
                for columnIndex, value := range row </span><span class="cov8" title="1">{
                        err := convertCsvRowToTaskStruct(int64(columnIndex), value, &amp;task)

                        if err != nil </span><span class="cov0" title="0">{
                                continue</span>
                        }
                }
                <span class="cov8" title="1">tasks = append(tasks, task)</span>
        }

        <span class="cov8" title="1">return tasks</span>
}

func createTaskRow(id int64, description string, isComplete bool, createdAt time.Time) []string <span class="cov8" title="1">{
        task := Task{
                ID:          id,
                description: description,
                isComplete:  isComplete,
                createdAt:   createdAt,
        }
        createdAtStr := task.createdAt.Format(time.RFC3339)
        isCompleteStr := strconv.FormatBool(task.isComplete)
        idStr := strconv.FormatInt(task.ID, 10)
        taskRow := []string{idStr, task.description, createdAtStr, isCompleteStr}

        return taskRow
}</span>

func findTaskById(id int64) (int64, bool) <span class="cov8" title="1">{
        for index, value := range getListTasks() </span><span class="cov8" title="1">{
                if value.ID == id </span><span class="cov8" title="1">{
                        return int64(index), true
                }</span>
        }

        <span class="cov8" title="1">return -1, false</span>
}

func getLastRowId() int64 <span class="cov8" title="1">{
        tasks := getListTasks()
        length := len(tasks)
        if length == 0 </span><span class="cov8" title="1">{
                return 0
        }</span>
        <span class="cov8" title="1">lastRow := tasks[length-1]
        return lastRow.ID + 1</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
